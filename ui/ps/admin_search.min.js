"use strict";gx.extensions.module("admin_search",["user_configuration_service","url_arguments","loading_spinner"],function(e){var r,i=$(this),t=$(e.button),a=$("ul.searchable:first"),s=$.trim(decodeURIComponent(jse.libs.url_arguments.getUrlParameters(location.href).search||"")),n={searchIn:jse.core.lang.translate("admin_search_in_label","admin_labels"),orders:jse.core.lang.translate("admin_search_orders","admin_labels"),invoices:jse.core.lang.translate("admin_search_invoices","admin_labels"),customers:jse.core.lang.translate("admin_search_customers","admin_labels"),categories:jse.core.lang.translate("admin_search_categories","admin_labels")},c={ESC:27,ARROW_UP:38,ARROW_DOWN:40,ENTER:13},o=jse.libs.user_configuration_service,l=(jse.libs.url_arguments,{userId:e.customer_id,configurationKey:"recent_search_area"}),d={},g=function(){$(".search-item.active").length||console.error("No active list item!"),r=$(".search-item.active").data("searchArea"),i.trigger("refresh:search-area")},h=function(){i.on("click",function(){i.trigger("refresh:search-area"),""===i.val()&&i.val(s),a.trigger("show:dropdown"),i.trigger("focus")}),i.on("keyup",function(e){switch(e.which){case c.ENTER:i.trigger("perform:search");break;case c.ESC:return void a.trigger("hide:dropdown");case c.ARROW_UP:a.trigger("select:item:previous");break;case c.ARROW_DOWN:a.trigger("select:item:next")}a.trigger("refresh:search-item")}),i.on("perform:search",function(){var e,t=encodeURIComponent(i.val()),s="_self";switch(r){case"customers":e=["customers.php","?search=",t].join("");break;case"categories":e=["categories.php","?search=",t].join("");break;case"orders":e=["admin.php","?",$.param({"do":"OrdersOverview",filter:{number:t}})].join("");break;case"invoices":e=["admin.php","?",$.param({"do":"InvoicesOverview",filter:{invoiceNumber:t}})].join("")}jse.libs.loading_spinner.show(a,"9999"),o.set({data:$.extend(l,{configurationValue:r}),onSuccess:function(){window.open(e,s)},onError:function(){window.open(e,s)}})}),i.on("refresh:search-area",function(){i.prop("placeholder",n[r])}),i.on("blur",function(){i.prop("placeholder",""),a.trigger("hide:dropdown")})},m=function(){t.on("click",function(){i.trigger("refresh:search-area"),i.val(s),a.trigger("show:dropdown"),i.trigger("focus")})},u=function(){a.on("select:item",function(){a.find("li[data-search-area="+r+"]").addClass("active")}),a.on("show:dropdown",function(){a.fadeIn(),a.trigger("select:item"),a.trigger("refresh:search-item")}),a.on("select:item:first",function(){var e=a.find("li.search-item.active"),r=a.find("li.search-item:first");e.removeClass("active"),r.addClass("active"),g(),a.trigger("select:item")}),a.on("select:item:last",function(){var e=a.find("li.search-item.active"),r=a.find("li.search-item:last");e.removeClass("active"),r.addClass("active"),g(),a.trigger("select:item")}),a.on("select:item:previous",function(){var e=a.find("li.search-item.active"),r=e.prev();r.length?(e.removeClass("active"),r.addClass("active"),g(),a.trigger("select:item")):a.trigger("select:item:last")}),a.on("select:item:next",function(){var e=a.find("li.search-item.active"),r=e.next();r.length?(e.removeClass("active"),r.addClass("active"),g(),a.trigger("select:item")):a.trigger("select:item:first")}),a.on("hide:dropdown",function(){a.fadeOut()}),a.on("click",function(e){e.stopPropagation(),a.find("li").removeClass("active");var r=$(e.target).is("span")?$(e.target).parents("li:first"):$(e.target);r.addClass("active"),g(),a.trigger("hide:dropdown"),i.trigger("perform:search")}),a.on("refresh:search-item",function(){$(".search-item").each(function(){$(this).find(".search-query-item").text(i.val());var e=[n.searchIn,n[$(this).data("searchArea")]].join(" ");$(this).find(".search-query-description").text(e)})})},f=function(){$(document).on("JSENGINE_INIT_FINISHED",function(){""!=s&&(i.prop("value",s),i.focus(),a.trigger("show:dropdown"),a.trigger("refresh:search-item"))})};return d.init=function(i){h(),u(),m(),f(),r=e.recentSearchArea||"categories",a.trigger("select:item"),i()},d});